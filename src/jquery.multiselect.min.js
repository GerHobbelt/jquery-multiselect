/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, boss:true, undef:true, curly:true, browser:true, jquery:true */
/*
 * jQuery MultiSelect UI Widget 2.0.1
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.11 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
!function(a,b){var c=0,d=a(document);a.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",showCheckAll:!0,showUncheckAll:!0,selectedText:"# selected",selectedList:0,closeIcon:"ui-icon-circle-close",show:null,hide:null,autoOpen:!1,multiple:!0,position:{},appendTo:null,menuWidth:null,selectedListSeparator:", ",disableInputsOnToggle:!0,groupColumns:!1},_getAppendEl:function(){var b=this.options.appendTo;return b&&(b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)),b&&b[0]||(b=this.element.closest(".ui-front, dialog")),b.length||(b=this.document[0].body),b},_create:function(){var b=this.element,d=this.options;this.speed=a.fx.speeds._default,this._isOpen=!1,this.inputIdCounter=0,this._namespaceID=this.eventNamespace||"multiselect"+c,this.multiselectID=c++;var e=(this.button=a('<button type="button"><span class="ui-icon ui-icon-triangle-1-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(d.classes).attr({title:b.attr("title"),tabIndex:b.attr("tabIndex"),id:b.attr("id")?b.attr("id")+"_ms":null}).prop("aria-haspopup",!0).insertAfter(b);this.buttonlabel=a("<span />").html(d.noneSelectedText).appendTo(e),this.menu=a("<div />").addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(d.classes).appendTo(this._getAppendEl()),this.header=a("<div />").addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(this.menu),this.headerLinkContainer=a("<ul />").addClass("ui-helper-reset").html(function(){if(d.header===!0){var a="";return d.showCheckAll&&(a='<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+d.checkAllText+"</span></a></li>"),d.showUncheckAll&&(a+='<li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+d.uncheckAllText+"</span></a></li>"),a}return"string"==typeof d.header?"<li>"+d.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon '+d.closeIcon+'"></span></a></li>').appendTo(this.header);(this.checkboxContainer=a("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(this.menu);this._bindEvents(),this.refresh(!0),d.multiple||this.menu.addClass("ui-multiselect-single"),b.hide()},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple?this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").show():this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},_makeOption:function(b){var c=b.title?b.title:null,d=b.value,e=this.element.attr("id")||this.multiselectID,f="ui-multiselect-"+this.multiselectID+"-"+(b.id||e+"-option-"+this.inputIdCounter++),g=b.disabled,h=b.selected,i=["ui-corner-all"],j=[],k=this.options;g&&(j.push("ui-multiselect-disabled"),i.push("ui-state-disabled")),b.className&&j.push(b.className),h&&!k.multiple&&i.push("ui-state-active");var l=a("<li/>").addClass(j.join(" ")),m=a("<label/>").attr({for:f,title:c}).addClass(i.join(" ")).appendTo(l);a("<input/>").attr({name:"multiselect_"+e,type:k.multiple?"checkbox":"radio",value:d,title:c,id:f,checked:h?"checked":null,"aria-selected":h?"true":null,disabled:g?"disabled":null,"aria-disabled":g?"true":null}).data(a(b).data()).appendTo(m);return a("<span/>").text(a(b).text()).appendTo(m),l},_buildOptionList:function(b,c){var d=this;b.children().each(function(){var b=a(this);if("OPTGROUP"===this.tagName){var e=a("<ul/>").addClass("ui-multiselect-optgroup "+this.className).appendTo(c);d.options.groupColumns&&e.addClass("ui-multiselect-columns"),a("<a/>").text(this.getAttribute("label")).appendTo(e),d._buildOptionList(b,e)}else{d._makeOption(this).appendTo(c)}})},refresh:function(b){var d=this.element,f=(this.options,this.menu),i=(this.checkboxContainer,a("<ul/>").addClass("ui-multiselect-checkboxes ui-helper-reset"));this.inputIdCounter=0,this.options.header&&(this.options.multiple?this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").show():this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide()),this._buildOptionList(d,i),this.menu.find(".ui-multiselect-checkboxes").remove(),this.menu.append(i),this.labels=f.find("label"),this.inputs=this.labels.children("input"),this._setButtonWidth(),this.update(!0),b||this._trigger("refresh")},update:function(b){var g,c=this.options,d=this.inputs,e=d.filter(":checked"),f=e.length;g=0===f?c.noneSelectedText:a.isFunction(c.selectedText)?c.selectedText.call(this,f,d.length,e.get()):/\d/.test(c.selectedList)&&c.selectedList>0&&f<=c.selectedList?e.map(function(){return a(this).next().text()}).get().join(c.selectedListSeparator):c.selectedText.replace("#",f).replace("#",d.length),this._setButtonValue(g),b&&(this.button[0].defaultValue=g)},_setButtonValue:function(a){this.buttonlabel.text(a)},_bindButtonEvents:function(){function d(){return b[b._isOpen?"close":"open"](),!1}var b=this,c=this.button;c.find("span").bind("click.multiselect",d),c.bind({click:d,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){c.hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},mouseleave:function(){a(this).removeClass("ui-state-hover")},focus:function(){c.hasClass("ui-state-disabled")||a(this).addClass("ui-state-focus")},blur:function(){a(this).removeClass("ui-state-focus")}})},_bindMenuEvents:function(){var b=this;this.menu.delegate(".ui-multiselect-optgroup a","click.multiselect",function(c){c.preventDefault();var d=a(this),e=d.parent().find("input:visible:not(:disabled)"),f=e.get(),g=d.text();b._trigger("beforeoptgrouptoggle",c,{inputs:f,label:g})!==!1&&(b._toggleChecked(e.filter(":checked").length!==e.length,e),b._trigger("optgrouptoggle",c,{inputs:f,label:g,checked:f.length?f[0].checked:null}))}).delegate("label","mouseenter.multiselect",function(){a(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),a(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(c){if(82!==c.which&&!(c.which>111&&c.which<124))switch(c.preventDefault(),c.which){case 9:c.shiftKey?(b.menu.find(".ui-state-hover").removeClass("ui-state-hover"),b.header.find("li").last().find("a").focus()):b.close();break;case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(c.which,this);break;case 13:case 32:a(this).find("input")[0].click();break;case 65:c.altKey&&b.checkAll();break;case 85:c.altKey&&b.uncheckAll()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(c){var d=a(this),e=this.value,f=d.parent().find("span").text(),g=this.checked,h=b.element.find("option");return this.disabled||b._trigger("click",c,{value:e,text:f,checked:g})===!1?void c.preventDefault():(d.focus(),d.prop("aria-selected",g),h.each(function(){this.value===e?this.selected=g:b.options.multiple||(this.selected=!1)}),b.options.multiple||(b.labels.removeClass("ui-state-active"),d.closest("label").toggleClass("ui-state-active",g),b.close()),b.element.trigger("change"),void setTimeout(a.proxy(b.update,b),10))})},_bindHeaderEvents:function(){var b=this;this.header.delegate("a","click.multiselect",function(c){var d=a(this);d.hasClass("ui-multiselect-close")?b.close():d.hasClass("ui-multiselect-all")?b.checkAll():d.hasClass("ui-multiselect-none")&&b.uncheckAll(),c.preventDefault()}).delegate("a","keydown.multiselect",function(c){switch(c.which){case 27:b.close();break;case 9:var d=a(c.target);(!c.shiftKey||d.parent().prev().length||b.header.find(".ui-multiselect-filter").length)&&(d.parent().next().length||b.labels.length||c.shiftKey)||(b.close(),c.preventDefault())}})},_bindEvents:function(){var b=this;this._bindButtonEvents(),this._bindMenuEvents(),this._bindHeaderEvents(),d.bind("mousedown."+b._namespaceID,function(c){var d=c.target;!b._isOpen||d===b.button[0]||d===b.menu[0]||a.contains(b.menu[0],d)||a.contains(b.button[0],d)||b.close()}),a(this.element[0].form).bind("reset."+this._namespaceID,function(){setTimeout(a.proxy(b.refresh,b),10)})},_getMinWidth:function(){var a=this.options.minWidth,b=0;switch(typeof a){case"number":b=a;break;case"string":var c=a[a.length-1];b=a.match(/\d+/),b="%"===c?this.element.parent().outerWidth()*(b/100):parseInt(a,10)}return b},_setButtonWidth:function(){var a=this._getMinWidth();this.button.outerWidth(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()<=0?this._getMinWidth():this.button.outerWidth();a.outerWidth(this.options.menuWidth||b)},_setMenuHeight:function(){var b=this.menu.children(".ui-multiselect-header:visible").outerHeight(!0),c=0;this.menu.find(".ui-multiselect-checkboxes li, .ui-multiselect-checkboxes a").each(function(b,d){c+=a(d).outerHeight(!0)}),c>this.options.height?(this.menu.children(".ui-multiselect-checkboxes").css("overflow","auto"),c=this.options.height):this.menu.children(".ui-multiselect-checkboxes").css("overflow","hidden"),this.menu.children(".ui-multiselect-checkboxes").height(c),this.menu.height(c+b)},_resizeMenu:function(){this._setMenuWidth(),this._setMenuHeight()},_traverse:function(b,c){var d=a(c),e=38===b||37===b,f=d.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup):visible").first();if(f.length||(f=d.parents(".ui-multiselect-optgroup")[e?"prev":"next"]()),f.length)f.find("label:visible")[e?"last":"first"]().trigger("mouseover");else{var g=this.menu.find("ul").last();this.menu.find("label:visible")[e?"last":"first"]().trigger("mouseover"),g.scrollTop(e?g.height():0)}},_toggleState:function(a,b){return function(){this.disabled||(this[a]=b),b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(a,b){var c=b&&b.length?b:this.inputs,d=this;c.each(this._toggleState("checked",a)),c.eq(0).focus(),this.update();var e={};c.each(function(){e[this.value]=!0}),this.element.find("option").each(function(){!this.disabled&&e[this.value]&&d._toggleState("selected",a).call(this)}),c.length&&this.element.trigger("change")},_toggleDisabled:function(a){if(this.button.prop({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled"),this.options.disableInputsOnToggle){var b=this.menu.find(".ui-multiselect-checkboxes").get(0),c=[],d="ech-multiselect-disabled",e=0;if(a)for(c=b.querySelectorAll("input:enabled"),e=0;e<c.length;e++)c[e].setAttribute(d,!0),c[e].setAttribute("disabled","disabled"),c[e].setAttribute("aria-disabled","disabled"),c[e].parentNode.className=c[e].parentNode.className+" ui-state-disabled";else for(c=b.querySelectorAll("input:disabled"),e=0;e<c.length;e++)c[e].hasAttribute(d)&&(c[e].removeAttribute(d),c[e].removeAttribute("disabled"),c[e].removeAttribute("aria-disabled"),c[e].parentNode.className=c[e].parentNode.className.replace(" ui-state-disabled",""))}this.element.prop({disabled:a,"aria-disabled":a})},open:function(b){var c=this,d=this.button,e=this.menu,f=this.speed,g=this.options,h=[];if(this._trigger("beforeopen")!==!1&&!d.hasClass("ui-state-disabled")&&!this._isOpen){var i=e.find(".ui-multiselect-checkboxes"),j=g.show;a.isArray(g.show)&&(j=g.show[0],f=g.show[1]||c.speed),j&&(h=[j,f]),i.scrollTop(0),a.fn.show.apply(e,h),this._resizeMenu(),this.position();var k=this.header.find(".ui-multiselect-filter");k.length?k.first().find("input").trigger("focus"):this.labels.length?this.labels.filter(":not(.ui-state-disabled)").eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"):this.header.find("a").first().trigger("focus"),d.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==!1){var b=this.options,c=b.hide,d=this.speed,e=[];a.isArray(b.hide)&&(c=b.hide[0],d=b.hide[1]||this.speed),c&&(e=[c,d]),a.fn.hide.apply(this.menu,e),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close"),this.button.trigger("focus")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(a){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},getUnchecked:function(){return this.menu.find("input").not(":checked")},destroy:function(){return a.Widget.prototype.destroy.call(this),d.unbind(this._namespaceID),a(this.element[0].form).unbind(this._namespaceID),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},getMenu:function(){return this.menu},getLabels:function(){return this.labels},addOption:function(b,c,d){var e=a("<option/>").attr(b).text(c),f=e.get(0);d?(this.element.children("OPTGROUP").filter(function(){return a(this).prop("label")===d}).append(e),this.menu.find(".ui-multiselect-optgroup").filter(function(){return a(this).find("a").text()===d}).append(this._makeOption(f))):(this.element.append(e),this.menu.find(".ui-multiselect-checkboxes").append(this._makeOption(f))),this.labels=this.menu.find("label"),this.inputs=this.labels.children("input")},removeOption:function(a){a&&(this.element.find("option[value="+a+"]").remove(),this.labels.find("input[value="+a+"]").parents("li").remove(),this.labels=this.menu.find("label"),this.inputs=this.labels.children("input"))},position:function(){var b={my:"top",at:"bottom",of:this.button};a.isEmptyObject(this.options.position)||(b.my=this.options.position.my||b.my,b.at=this.options.position.at||b.at,b.of=this.options.position.of||b.of),a.ui&&a.ui.position?this.menu.position(b):(b=this.button.position(),b.top+=this.button.outerHeight(!1),this.menu.offset(b))},_setOption:function(b,c){var d=this.menu;switch(b){case"header":"boolean"==typeof c?this.header[c?"show":"hide"]():"string"==typeof c&&(this.headerLinkContainer.children("li:not(:last-child)").remove(),this.headerLinkContainer.prepend("<li>"+c+"</li>"));break;case"checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(c);break;case"uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(c);break;case"height":this.options[b]=c,this._setMenuHeight();break;case"minWidth":case"menuWidth":this.options[b]=c,this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[b]=c,this.update();break;case"classes":d.add(this.button).removeClass(this.options.classes).addClass(c);break;case"multiple":d.toggleClass("ui-multiselect-single",!c),this.options.multiple=c,this.element[0].multiple=c,this.uncheckAll(),this.refresh();break;case"position":this.position();break;case"selectedListSeparator":this.options[b]=c,this.update(!0)}a.Widget.prototype._setOption.apply(this,arguments)}})}(jQuery);